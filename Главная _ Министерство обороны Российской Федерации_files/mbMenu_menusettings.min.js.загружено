!function($){$.mbMenu={name:"mbMenu",author:"Matteo Bicocchi",version:"2.8.5rc5",actualMenuOpener:!1,options:{template:"yourMenuVoiceTemplate",additionalData:"",menuSelector:".menuContainer",menuWidth:400,stretchMenu:!1,useBullet:"",openOnRight:!1,containment:"window",iconPath:"ico/",hasImages:!0,fadeInTime:100,fadeOutTime:200,menuTop:0,menuLeft:0,submenuTop:0,submenuLeft:4,opacity:1,openOnClick:!0,closeOnMouseOut:!1,closeAfter:500,minZindex:"auto",hoverIntent:0,submenuHoverIntent:200,onContextualMenu:function(){}},buildMenu:function(a){return this.each(function(){var b=this;b.id=this.id?this.id:"menu_"+Math.floor(1e3*Math.random()),this.options={},$.extend(this.options,$.mbMenu.options),$.extend(this.options,a),$(".mbmenu").hide(),b.clicked=!1,b.rootMenu=!1,b.actualOpenedMenu=!1,b.menuvoice=!1;var c=$(this),d=this.options.openOnClick,e=this.options.closeOnMouseOut;$(c).each(function(){$.metadata&&($.metadata.setType("class"),b.menuvoice=$(this).find(".rootVoice"),$(b.menuvoice).each(function(){$(this).metadata().menu&&$(this).attr("menu",$(this).metadata().menu),$(this).metadata().disabled&&$(this).attr("isDisable",$(this).metadata().disabled)})),b.menuvoice=$(this).find("[menu]").add($(this).filter("[menu]")),b.menuvoice.filter("[isDisable]").addClass("disabled"),""!=this.options.useBullet&&$(b.menuvoice).append(this.options.useBullet),$(b.menuvoice).css("white-space","nowrap"),d&&$(b.menuvoice).bind("click",function(){$(document).unbind("click.closeMbMenu"),$(this).attr("isOpen")?($(this).removeMbMenu(b,!0),$(this).addClass("selected")):($(this).buildMbMenu(b,$(this).attr("menu")),$(this).attr("isOpen","true")),"empty"==$(this).attr("menu")&&(b.actualOpenedMenu&&$("[isOpen]").removeAttr("isOpen"),$(this).removeMbMenu(b)),$(document).unbind("click.closeMbMenu")});$.browser.msie?"mouseenter":"mouseover",$.browser.msie?"mouseleave":"mouseout";$(b.menuvoice).mb_hover(this.options.hoverIntent,function(){$(this).attr("isOpen")||$("[isOpen]").removeAttr("isOpen"),e&&clearTimeout($.mbMenu.deleteOnMouseOut),d||$(b).find(".selected").removeClass("selected"),b.actualOpenedMenu&&$(b.actualOpenedMenu).removeClass("selected"),$(this).addClass("selected"),!b.clicked&&d||$(this).attr("isOpen")||($(this).removeMbMenu(b),$(this).buildMbMenu(b,$(this).attr("menu")),"empty"==$(this).attr("menu")&&$(this).removeMbMenu(b),$(this).attr("isOpen","true"))},function(){e&&($.mbMenu.deleteOnMouseOut=setTimeout(function(){$(this).removeMbMenu(b,!0),$(document).unbind("click.closeMbMenu")},$(c)[0].options.closeAfter)),"empty"==$(this).attr("menu")&&$(this).removeClass("selected"),b.clicked||$(this).removeClass("selected"),$(document).one("click.closeMbMenu",function(){$("[isOpen]").removeAttr("isOpen"),$(this).removeClass("selected"),$(this).removeMbMenu(b,!0),b.rootMenu=!1,b.clicked=!1})})})})},buildContextualMenu:function(a){return this.each(function(){var b=this;b.options={},$.extend(b.options,$.mbMenu.options),$.extend(b.options,a),$(".mbmenu").hide(),b.clicked=!1,b.rootMenu=!1,b.actualOpenedMenu=!1,b.menuvoice=!1;var c;$.metadata&&($.metadata.setType("class"),c=$(this).find(".cmVoice"),$(c).each(function(){$(this).metadata().cMenu&&$(this).attr("cMenu",$(this).metadata().cMenu)})),c=$(this).find("[cMenu]").add($(this).filter("[cMenu]")),$(c).each(function(){$(this).css({"-webkit-user-select":"none","-moz-user-select":"none"});var a=this;a.id=a.id?a.id:"menu_"+Math.floor(100*Math.random()),$(a).css({cursor:"default"}),$(a).bind("contextmenu","mousedown",function(c){c.preventDefault(),c.stopPropagation(),c.cancelBubble=!0,$.mbMenu.lastContextMenuEl=a,$.mbMenu.options.actualMenuOpener&&$(b).removeMbMenu($.mbMenu.options.actualMenuOpener),b.options.onContextualMenu(this,c),$(this).buildMbMenu(b,$(this).attr("cMenu"),"cm",c),$(this).attr("isOpen","true")})})})}},$.fn.extend({buildMbMenu:function(op,m,type,e){var msie6=$.browser.msie&&"6.0"==$.browser.version,mouseOver=$.browser.msie?"mouseenter":"mouseover",mouseOut=$.browser.msie?"mouseleave":"mouseout";if(e&&(this.mouseX=$(this).getMouseX(e),this.mouseY=$(this).getMouseY(e)),$.mbMenu.options.actualMenuOpener&&$.mbMenu.options.actualMenuOpener!=op&&$(op).removeMbMenu($.mbMenu.options.actualMenuOpener),$.mbMenu.options.actualMenuOpener=op,type&&"cm"!=type||(op.rootMenu&&($(op.rootMenu).removeMbMenu(op),$(op.actualOpenedMenu).removeAttr("isOpen"),$("[isOpen]").removeAttr("isOpen")),op.clicked=!0,op.actualOpenedMenu=this,$(op.actualOpenedMenu).attr("isOpen","true"),$(op.actualOpenedMenu).addClass("selected")),"empty"!=$(this).attr("menu")){var opener=this,where=type&&"cm"!=type?$(this).parent().parent():$(document.body),menuClass=op.options.menuSelector.replace(".","");op.rootMenu&&(menuClass+=" submenuContainer"),!op.rootMenu&&$(opener).attr("isDisable")&&(menuClass+=" disabled"),where.append("<div class='menuDiv'><div class='"+menuClass+" '></div></div>"),this.menu=where.find(".menuDiv"),$(this.menu).css({width:0,height:0}),"auto"!=op.options.minZindex?$(this.menu).css({zIndex:op.options.minZindex++}):$(this.menu).mb_bringToFront(),this.menuContainer=$(this.menu).find(op.options.menuSelector),$(this.menuContainer).bind(mouseOver,function(){$(opener).addClass("selected")}),$(this.menuContainer).css({position:"absolute",opacity:op.options.opacity}),$("#"+m).html()||$.ajax({type:"POST",url:op.options.template,cache:!1,async:!1,data:"menuId="+m+(""!=op.options.additionalData?"&"+op.options.additionalData:""),success:function(a){$("body").append(a),$("#"+m).hide()}}),$(this.menuContainer).attr("id","mb_"+m).hide();var isBoxmenu=$("#"+m).hasClass("boxMenu");isBoxmenu?(this.voices=$("#"+m).clone(!0),this.voices.css({display:"block"}),this.voices.attr("id",m+"_clone")):this.voices=$("#"+m).find("a").clone(!0),$.metadata&&($.metadata.setType("class"),$(this.voices).each(function(){$(this).metadata().disabled&&$(this).attr("isdisable",$(this).metadata().disabled),$(this).metadata().img&&$(this).attr("img",$(this).metadata().img),$(this).metadata().menu&&$(this).attr("menu",$(this).metadata().menu),$(this).metadata().action&&$(this).attr("action",$(this).metadata().action)})),$(this.voices).each(function(i){var voice=this,imgPlace="",isText="text"==$(voice).attr("rel"),isTitle="title"==$(voice).attr("rel"),isDisabled=$(voice).is("[isdisable]");!op.rootMenu&&$(opener).attr("isDisable")&&(isDisabled=!0);var isSeparator="separator"==$(voice).attr("rel");if(op.options.hasImages&&!isText&&!isBoxmenu){var imgPath=$(voice).attr("img")?$(voice).attr("img"):"blank.gif";imgPath=imgPath.length>3&&imgPath.indexOf(".")>-1?"<img class='imgLine' src='"+op.options.iconPath+imgPath+"'>":imgPath,imgPlace="<td class='img'>"+imgPath+"</td>"}var line="<table id='"+m+"_"+i+"' class='line"+(isTitle?" title":"")+"' cellspacing='0' cellpadding='0' border='0' style='width:100%;' width='100%'><tr>"+imgPlace+"<td class='voice' nowrap></td></tr></table>";isSeparator&&(line="<p class='separator' style='width:100%;'></p>"),isText&&(line="<div style='width:100%; display:table' class='line' id='"+m+"_"+i+"'><div class='voice'></div></div>"),isBoxmenu&&(line="<div style='width:100%; display:inline' class='' id='"+m+"_"+i+"'><div class='voice'></div></div>"),$(opener.menuContainer).append(line);var menuLine=$(opener.menuContainer).find("#"+m+"_"+i),menuVoice=menuLine.find(".voice");isSeparator||(menuVoice.append(this),$(this).attr("menu")&&!isDisabled&&(menuLine.find(".voice a").wrap("<div class='menuArrow'></div>"),menuLine.find(".menuArrow").addClass("subMenuOpener"),menuLine.css({cursor:"default"}),this.isOpener=!0),isText&&(menuVoice.addClass("textBox"),$.browser.msie&&menuVoice.css({maxWidth:op.options.menuWidth}),this.isOpener=!0),isDisabled&&menuLine.addClass("disabled").css({cursor:"default"}),isText||isTitle||isDisabled||isBoxmenu||(menuLine.css({cursor:"pointer"}),menuLine.bind("mouseover",function(){clearTimeout($.mbMenu.deleteOnMouseOut),$(this).addClass("selected")}),menuLine.bind("mouseout",function(){$(this).removeClass("selected")}),menuLine.mb_hover(op.options.submenuHoverIntent,function(a){if(opener.menuContainer.actualSubmenu&&!$(voice).attr("menu")&&($(opener.menu).find(".menuDiv").remove(),$(opener.menuContainer.actualSubmenu).removeClass("selected"),opener.menuContainer.actualSubmenu=!1),$(voice).attr("menu"))return opener.menuContainer.actualSubmenu&&opener.menuContainer.actualSubmenu!=this&&($(opener.menu).find(".menuDiv").remove(),$(opener.menuContainer.actualSubmenu).removeClass("selected"),opener.menuContainer.actualSubmenu=!1),$(voice).attr("action")||$(opener.menuContainer).find("#"+m+"_"+i).css("cursor","default"),opener.menuContainer.actualSubmenu&&opener.menuContainer.actualSubmenu==this||($(opener.menu).find(".menuDiv").remove(),opener.menuContainer.actualSubmenu=!1,$(this).buildMbMenu(op,$(voice).attr("menu"),"sm",a),opener.menuContainer.actualSubmenu=this),$(this).attr("isOpen","true"),!1},function(){})),(isDisabled||isTitle||isText||isBoxmenu)&&($(this).removeAttr("href"),menuLine.bind(mouseOver,function(){closeOnMouseOut&&clearTimeout($.mbMenu.deleteOnMouseOut),opener.menuContainer.actualSubmenu&&($(opener.menu).find(".menuDiv").remove(),opener.menuContainer.actualSubmenu=!1)}).css("cursor","default")),menuLine.bind("click",function(){if(!$(voice).attr("action")&&!$(voice).attr("href")||isDisabled||isBoxmenu||isText)$(document).unbind("click.closeMbMenu");else{var target=$(voice).attr("target")?$(voice).attr("target"):"_self";$(voice).attr("href")&&$(voice).attr("href").indexOf("javascript:")>-1&&$(voice).attr("action",$(voice).attr("href").replace("javascript:",""));var link=$(voice).attr("action")?$(voice).attr("action"):"window.open('"+$(voice).attr("href")+"', '"+target+"')";$(voice).removeAttr("href"),eval(link),$(this).removeMbMenu(op,!0)}}))});var closeOnMouseOut=$(op)[0].options.closeOnMouseOut;closeOnMouseOut&&($(opener.menuContainer).bind("mouseenter",function(){clearTimeout($.mbMenu.deleteOnMouseOut)}),$(opener.menuContainer).bind("mouseleave",function(){var a=$.mbMenu.options.actualMenuOpener;$.mbMenu.deleteOnMouseOut=setTimeout(function(){$(this).removeMbMenu(a,!0),$(document).unbind("click.closeMbMenu")},$(op)[0].options.closeAfter)}));var t=0,l=0;switch($(this.menuContainer).css({minWidth:op.options.menuWidth}),$.browser.msie&&$(this.menuContainer).css("width",op.options.stretchMenu&&"sm"!=type&&"cm"!=type&&!op.options.openOnRight?$(this).outerWidth():$(this.menuContainer).width()+2),type){case"sm":t=$(this).position().top+op.options.submenuTop,l=$(this).position().left+$(this).width()-op.options.submenuLeft;break;case"cm":t=this.mouseY-5,l=this.mouseX-5;break;default:if(op.options.openOnRight)t=$(this).offset().top-($.browser.msie?2:0)+op.options.menuTop,l=$(this).offset().left+$(this).outerWidth()-op.options.menuLeft-($.browser.msie&&$.browser.version<8?2:0);else if(t=$(this).offset().top+$(this).outerHeight()-($.browser.mozilla?0:2)+op.options.menuTop,l=$(this).offset().left+op.options.menuLeft,op.options.stretchMenu){var _w=$(this).outerWidth();$(this.menuContainer).css({width:_w})}}$(this.menu).css({position:"absolute",top:t,left:l}),type&&"cm"!=type||(op.rootMenu=this.menu),$(this.menuContainer).bind(mouseOut,function(){$(document).one("click.closeMbMenu",function(){$(document).removeMbMenu(op,!0)})}),op.options.fadeInTime>0?$(this.menuContainer).fadeIn(op.options.fadeInTime):$(this.menuContainer).show();var wh="window"==op.options.containment?$(window).height():$("#"+op.options.containment).offset().top+$("#"+op.options.containment).outerHeight(),ww="window"==op.options.containment?$(window).width():$("#"+op.options.containment).offset().left+$("#"+op.options.containment).outerWidth(),mh=$(this.menuContainer).outerHeight(),mw=$(this.menuContainer).outerWidth(),actualX=$(where.find(".menuDiv:first")).offset().left-$(window).scrollLeft(),actualY=$(where.find(".menuDiv:first")).offset().top-$(window).scrollTop();switch(type){case"sm":actualX+mw>=ww&&mw<ww&&(l-=2*op.options.menuWidth-2*op.options.submenuLeft);break;case"cm":actualX+1.5*op.options.menuWidth>=ww&&mw<ww&&(l-=op.options.menuWidth-op.options.submenuLeft);break;default:actualX+mw>=ww&&mw<ww&&(l-=$(this.menuContainer).offset().left+mw-ww+18)}actualY+mh>=wh-10&&mh<wh&&(t-=actualY+mh-wh+10),$(this.menu).css({top:t,left:l})}},removeMbMenu:function(a,b){a||(a=$.mbMenu.options.actualMenuOpener),a&&a.rootMenu&&($(a.actualOpenedMenu).removeAttr("isOpen").removeClass("selected"),$("[isOpen]").removeAttr("isOpen"),$(a.rootMenu).css({width:1,height:1}),b?$(a.rootMenu).fadeOut(a.options.fadeOutTime,function(){$.browser.msie&&$.browser.version<9?this.parentNode.removeChild(this):$(this).remove()}):$(a.rootMenu).remove(),a.rootMenu=!1,a.clicked=!1)},getMouseX:function(a){var b;return b=$.browser.msie?a.clientX+document.documentElement.scrollLeft:a.pageX,b<0&&(b=0),b},getMouseY:function(a){var b;return b=$.browser.msie?a.clientY+document.documentElement.scrollTop:a.pageY,b<0&&(b=0),b},mb_bringToFront:function(){var a=10;$("*").each(function(){if("absolute"==$(this).css("position")||"fixed"==$(this).css("position")){var b=parseInt($(this).css("zIndex"));a=b>a?parseInt($(this).css("zIndex")):a}}),$(this).css("zIndex",a+=10)},mb_hover:function(a,b,c){0==a?$(this).hover(b,c):$(this).hoverIntent({sensitivity:30,interval:a,timeout:0,over:b,out:c})}}),$.fn.buildMenu=$.mbMenu.buildMenu,$.fn.buildContextualMenu=$.mbMenu.buildContextualMenu}(jQuery),$(function(){$(".myMenu").buildMenu({menuSelector:".menuContainer",menuWidth:171,stretchMenu:!0,useBullet:"<span>&nbsp;</span>",openOnRight:!1,hasImages:!1,fadeInTime:100,fadeOutTime:300,opacity:.99,shadow:!1,openOnClick:!1,closeOnMouseOut:!0,closeAfter:700,minZindex:"auto",adjustLeft:2,adjustTop:10})});